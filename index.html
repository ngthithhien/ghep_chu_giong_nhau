<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Gh√©p ch·ªØ gi·ªëng nhau ‚Äî Chu·∫©n</title>
<style>
@font-face {
  font-family: "UTM Avo";
  src: url("./fonts/UTM-Avo.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

:root{
  --bg1:#667eea; --bg2:#764ba2;
  --accent1:#f093fb; --accent2:#f5576c;
  --good1:#84fab0; --good2:#8fd3f4;
  --green:#22c55e; --red:#ff4d4f;
}

html,body{
  height:100%;margin:0;padding:0;font-family:"UTM Avo",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
}
body{overflow:hidden;display:flex;align-items:stretch;justify-content:center;user-select:none;}

.game-container{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:3vh 2vw;box-sizing:border-box;}
.panel{
  width:100%;height:100%;background:#fff;border-radius:12px;box-shadow:0 28px 70px rgba(0,0,0,0.22);
  display:flex;flex-direction:column;align-items:center;padding:22px;position:relative;overflow:hidden;box-sizing:border-box;
}

.top-area{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:2px;}
.title{font-size:clamp(20px,3.6vw,34px);font-weight:800;color:#222;}
.timer-box{
  min-width:160px;padding:10px 18px;border-radius:12px;color:#fff;font-weight:800;
  background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 8px 20px rgba(0,0,0,0.12);text-align:center;
  font-size:clamp(16px,3.2vw,28px);
}

.game-area{flex:1;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;padding:8px 4vw;box-sizing:border-box;}

.letter-row{width:100%;display:flex;justify-content:center;align-items:center;gap:20px;flex-wrap:wrap;}
.letter-box{
  width:calc((100% - 60px)/3);max-width:260px;min-width:120px;height:32vh;
  border-radius:16px;display:flex;align-items:center;justify-content:center;
  font-weight:400;font-size:calc(12vh * 2.1);color:#222;background:#fff;
  box-shadow:0 12px 40px rgba(0,0,0,0.12);transition:transform .22s,box-shadow .22s;
  user-select:none;touch-action:none;
}

.letter-box.target{background:linear-gradient(135deg,#ffecd2,#fcb69f);border:5px dashed #ff6b6b;}
.letter-box.target.letter-hidden .letter-content{visibility:hidden;}
.letter-box.target.revealed{background:linear-gradient(135deg,var(--good1),var(--good2));box-shadow:0 20px 60px rgba(0,0,0,0.08);transform:scale(1.02);}

.letter-box.draggable{background:linear-gradient(135deg,#a8edea,#fed6e3);cursor:grab;}
.letter-box.dragging{transform:scale(1.03);z-index:2000;box-shadow:0 26px 80px rgba(0,0,0,0.18);}

.button-col{position:fixed;right:16px;top:16px;display:flex;flex-direction:column;gap:12px;align-items:center;z-index:2600;}
.game-button{min-width:88px;padding:12px 14px;border-radius:12px;border:none;color:#fff;font-weight:800;cursor:pointer;box-shadow:0 10px 26px rgba(0,0,0,0.16);font-size:16px;display:flex;align-items:center;justify-content:center;}
.end-button{background:linear-gradient(135deg,#b92b27,#1565C0)}
.play-button{background:linear-gradient(135deg,#11998e,#38ef7d)}
.replay-button{background:linear-gradient(135deg,#4facfe,#00f2fe)}

.fullscreen-button{min-width:88px;padding:12px 14px;border-radius:12px;border:none;background:linear-gradient(135deg,#6c5ce7,#a78bfa);color:#fff;font-weight:800;cursor:pointer;box-shadow:0 10px 26px rgba(0,0,0,0.16);font-size:16px;display:flex;align-items:center;justify-content:center;}

#fireworksCanvas{
  position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3000;
}
</style>
</head>
<body>
<canvas id="fireworksCanvas"></canvas>
<div class="game-container">
  <div class="panel">
    <div class="top-area">
      <div class="title">üéÆ Gh√©p ch·ªØ gi·ªëng nhau üß†</div>
      <div class="timer-box" id="timerBox">S·∫µn s√†ng!</div>
    </div>

    <div class="game-area" role="main">
      <div class="letter-row" id="targetRow">
        <div class="letter-box target" data-index="0" data-letter="b"><span class="letter-content">b</span></div>
        <div class="letter-box target" data-index="1" data-letter="d"><span class="letter-content">d</span></div>
        <div class="letter-box target" data-index="2" data-letter="ƒë"><span class="letter-content">ƒë</span></div>
      </div>
      <div class="letter-row" id="draggableRow">
        <div class="letter-box draggable" draggable="true" data-letter="b">b</div>
        <div class="letter-box draggable" draggable="true" data-letter="d">d</div>
        <div class="letter-box draggable" draggable="true" data-letter="ƒë">ƒë</div>
      </div>
    </div>
  </div>
</div>

<div class="button-col">
  <button id="endButton" class="game-button end-button">‚õî D·ª´ng l·∫°i</button>
  <button id="playButton" class="game-button play-button">üéØ Ch∆°i</button>
  <button id="replayButton" class="game-button replay-button" style="display:none">üîÑ Ch∆°i l·∫°i</button>
  <button id="btnFullscreen" class="fullscreen-button">‚§¢ To√†n m√†n h√¨nh</button>
</div>

<script>
/* Audio */
const audio={count5:new Audio('./sounds/5.mp3'),count4:new Audio('./sounds/4.mp3'),count3:new Audio('./sounds/3.mp3'),count2:new Audio('./sounds/2.mp3'),count1:new Audio('./sounds/1.mp3'),start:new Audio('./sounds/start.mp3'),correct:new Audio('./sounds/correct.mp3'),wrong:new Audio('./sounds/wrong.mp3'),win:new Audio('./sounds/win.mp3'),timeup:new Audio('./sounds/timeup.mp3')};
function safePlay(a){try{a.currentTime=0;a.play().catch(()=>{});}catch(e){} }

let gameActive=false,playTimer=null,remaining=0,correctCount=0,draggedElement=null;
const timerBox=document.getElementById("timerBox");
const btnPlay=document.getElementById("playButton");
const btnReplay=document.getElementById("replayButton");
const targetRow=document.getElementById("targetRow");
const draggableRow=document.getElementById("draggableRow");

function shuffleArray(a){const arr=a.slice();for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

function placeRandomTargets(){
  const letters=['b','d','ƒë'];
  const t=shuffleArray(letters);const trg=document.querySelectorAll('.letter-box.target');
  trg.forEach((el,i)=>{el.dataset.letter=t[i];el.querySelector('.letter-content').textContent=t[i];el.classList.remove('letter-hidden','revealed');});
  const d=shuffleArray(letters);const dr=document.querySelectorAll('.letter-box.draggable');
  dr.forEach((el,i)=>{el.dataset.letter=d[i];el.textContent=d[i];el.style.visibility='visible';el.draggable=true;});
  correctCount=0;
}

function startInitialCountdown(){
  if(gameActive)return;
  clearInterval(playTimer);
  placeRandomTargets();
  btnPlay.style.display='none';btnReplay.style.display='none';
  const seq=[5,4,3,2,1];let idx=0;
  function next(){
    if(idx<seq.length){timerBox.textContent=seq[idx];safePlay(audio['count'+seq[idx]]);idx++;setTimeout(next,1000);}else{
      timerBox.textContent='B·∫Øt ƒë·∫ßu!';safePlay(audio.start);
      setTimeout(()=>{
        document.querySelectorAll('.target').forEach(t=>t.classList.add('letter-hidden'));
        startPlayCountdown(3000);
      },900);
    }
  }
  next();
}

function startPlayCountdown(s){remaining=s;gameActive=true;timerBox.textContent='ƒêang ch∆°i...';playTimer=setInterval(()=>{if(remaining>0)remaining--;else endGame('H·∫øt gi·ªù!');},1000);}  

/* Ph√°o hoa nh·∫π nh√†ng */
const canvas=document.getElementById('fireworksCanvas');const ctx=canvas.getContext('2d');
canvas.width=innerWidth;canvas.height=innerHeight;
let fw=[];
function Firework(x,y){this.x=x;this.y=y;this.r=2;this.a=0.25;this.dx=(Math.random()-0.5)*2;this.dy=(Math.random()-0.5)*2;}
Firework.prototype.update=function(){this.x+=this.dx;this.y+=this.dy;this.r+=0.5;this.a-=0.01;}
Firework.prototype.draw=function(){ctx.globalAlpha=this.a;ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fillStyle='yellow';ctx.fill();ctx.globalAlpha=1;}
function spawnFireworks(){for(let i=0;i<18;i++){fw.push(new Firework(innerWidth/2,innerHeight/2));}}
function loopFw(){ctx.clearRect(0,0,canvas.width,canvas.height);fw.forEach((f,i)=>{f.update();f.draw();if(f.a<=0)fw.splice(i,1);});requestAnimationFrame(loopFw);}loopFw();

/* Drag */
draggableRow.addEventListener('dragstart',e=>{if(!gameActive){e.preventDefault();return;}const el=e.target.closest('.draggable');if(!el)return;draggedElement=el;el.classList.add('dragging');});
draggableRow.addEventListener('dragend',()=>{if(draggedElement)draggedElement.classList.remove('dragging');draggedElement=null;});

targetRow.addEventListener('dragover',e=>e.preventDefault());
targetRow.addEventListener('drop',e=>{e.preventDefault();if(!gameActive)return;const t=e.target.closest('.target');if(!t)return;const l=draggedElement.dataset.letter;handleDrop(l,draggedElement,t);});

function handleDrop(l,dragEl,targetEl){
  if(targetEl.classList.contains('revealed'))return;
  if(l===targetEl.dataset.letter){
    targetEl.classList.remove('letter-hidden');targetEl.classList.add('revealed');
    dragEl.style.visibility='hidden';dragEl.draggable=false;
    safePlay(audio.correct);
    spawnFireworks();
    correctCount++;
    if(correctCount>=3) endGame('üéâ Xu·∫•t s·∫Øc!');
  } else safePlay(audio.wrong);
}

function endGame(msg){gameActive=false;clearInterval(playTimer);timerBox.textContent=msg;btnReplay.style.display='inline-block';btnPlay.style.display='none';}

document.getElementById('endButton').onclick=()=>{endGame('ƒê√£ d·ª´ng tr√≤ ch∆°i');};
btnPlay.onclick=()=>startInitialCountdown();btnReplay.onclick=()=>startInitialCountdown();

/* FULLSCREEN */
const fs=document.getElementById('btnFullscreen');
fs.onclick=()=>{if(!document.fullscreenElement){document.documentElement.requestFullscreen();fs.textContent='‚§° Tho√°t to√†n m√†n h√¨nh';}else{document.exitFullscreen();fs.textContent='‚§¢ To√†n m√†n h√¨nh';}};
document.addEventListener('fullscreenchange',()=>{if(!document.fullscreenElement)fs.textContent='‚§¢ To√†n m√†n h√¨nh';});
</script>
</body>
</html>
